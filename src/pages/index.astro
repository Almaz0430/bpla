---
import Layout from "../layouts/Layout.astro";
import {
	MapPin,
	Map,
	Tractor,
	Truck,
	ShieldCheck,
	ChevronRight,
	ChevronsDown,
} from "lucide-react";
---

<Layout>
	<!-- Hero Section -->
	<section class="hero">
		<div class="video-background">
			<video
				id="video-1"
				class="hero-video active"
				autoplay
				muted
				playsinline
				preload="auto"
			>
				<source src="/hero/video-1.webm" type="video/webm" />
			</video>
			<video
				id="video-2"
				class="hero-video"
				muted
				playsinline
				preload="none"></video>
			<audio id="bg-audio" loop autoplay>
				<source src="/hero/sound.mp3" type="audio/mpeg" />
			</audio>
			<div class="overlay"></div>
		</div>

		<div class="hero-content">
			<!-- Audio tap hint -->
			<button
				id="audio-hint"
				class="audio-hint"
				aria-label="Включить звук"
			>
				<span class="audio-hint-icon">
					<svg
						width="28"
						height="28"
						viewBox="0 0 24 24"
						fill="none"
						xmlns="http://www.w3.org/2000/svg"
					>
						<path
							d="M9 11V6a2 2 0 0 1 4 0v5"
							stroke="white"
							stroke-width="1.8"
							stroke-linecap="round"
							stroke-linejoin="round"></path>
						<path
							d="M13 11V8a2 2 0 0 1 4 0v3"
							stroke="white"
							stroke-width="1.8"
							stroke-linecap="round"
							stroke-linejoin="round"></path>
						<path
							d="M17 11a2 2 0 0 1 4 0v3c0 4-3 7-7 7h-2c-2.5 0-4.5-1-6-3l-3-4a2 2 0 0 1 3-2.6L9 14V6a2 2 0 0 0-4 0"
							stroke="white"
							stroke-width="1.8"
							stroke-linecap="round"
							stroke-linejoin="round"></path>
						<path
							d="M5 6a2 2 0 0 1 4 0"
							stroke="white"
							stroke-width="1.8"
							stroke-linecap="round"
							stroke-linejoin="round"></path>
					</svg>
				</span>
				<span class="audio-hint-text">Нажмите для звука</span>
			</button>
			<p class="hero-desc">
				Комплексная система по обнаружению, идентификации и
				нейтрализации беспилотников, включающая радиоэлектронную борьбу
				и физическое уничтожение БПЛА
			</p>
		</div>

		<a href="#about" class="scroll-arrow" aria-label="Прокрутить вниз">
			<ChevronsDown size={40} strokeWidth={1.5} />
		</a>

		<script>
			const videoUrls = [
				"/hero/video-1.webm",
				"/hero/video-2.mp4",
				"/hero/video-3.mp4",
				"/hero/video-4.mp4",
				"/hero/video-5.mp4",
				"/hero/video-6.mp4",
				"/hero/video-7.mp4",
			];
			let currentIndex = 0;
			const v1 = document.getElementById("video-1") as HTMLVideoElement;
			const v2 = document.getElementById("video-2") as HTMLVideoElement;
			const players = [v1, v2];
			let activePlayerIndex = 0;
			const audio = document.getElementById(
				"bg-audio",
			) as HTMLAudioElement;

			const transition = () => {
				const nextIndex = (currentIndex + 1) % videoUrls.length;
				const nextPlayerIndex = (activePlayerIndex + 1) % 2;

				const currentPlayer = players[activePlayerIndex];
				const nextPlayer = players[nextPlayerIndex];

				// Pre-set source and play the next video hidden
				nextPlayer.src = videoUrls[nextIndex];
				nextPlayer.play();

				// Smooth fade
				nextPlayer.classList.add("active");
				currentPlayer.classList.remove("active");

				currentIndex = nextIndex;
				activePlayerIndex = nextPlayerIndex;

				// Re-attach time listener to the new current player
				nextPlayer.addEventListener("timeupdate", checkTime, {
					once: true,
				});
			};

			const checkTime = (e: Event) => {
				const player = e.target as HTMLVideoElement;
				// Start transition 1.5s before current video ends
				if (
					player.duration > 0 &&
					player.duration - player.currentTime < 1.5
				) {
					transition();
				} else {
					player.addEventListener("timeupdate", checkTime, {
						once: true,
					});
				}
			};

			// Initialize
			v1.addEventListener("timeupdate", checkTime, { once: true });

			// Scroll to top on load (fix mobile browser restoring scroll position)
			window.scrollTo({ top: 0, behavior: "instant" });

			// Audio hint button
			const audioHint = document.getElementById(
				"audio-hint",
			) as HTMLButtonElement;

			const hideHint = () => {
				if (audioHint) {
					audioHint.classList.add("hidden");
				}
			};

			// Audio handling: try immediate play, fallback to interaction if blocked
			const startAudio = () => {
				if (audio) {
					audio
						.play()
						.then(() => {
							// Autoplay succeeded — hide hint
							hideHint();
						})
						.catch(() => {
							console.log("Autoplay blocked, showing hint");
							// Show hint with animation
							if (audioHint) audioHint.classList.add("visible");
							// Click on hint button
							if (audioHint) {
								audioHint.addEventListener(
									"click",
									() => {
										audio.play();
										hideHint();
									},
									{ once: true },
								);
							}
							// Also allow any click/touch anywhere as fallback
							document.addEventListener(
								"click",
								() => {
									audio.play();
									hideHint();
								},
								{ once: true },
							);
							document.addEventListener(
								"touchstart",
								() => {
									audio.play();
									hideHint();
								},
								{ once: true },
							);
						});
				}
			};
			startAudio();
		</script>
	</section>

	<!-- About Section -->
	<section id="about" class="about-section">
		<div class="container">
			<div class="section-header">
				<h2>Системы противодействия</h2>
			</div>

			<div class="bento-grid">
				<div class="bento-item bento-large">
					<div class="dual-images" id="dual-images-slider">
						<img
							src="/photo/image_5.jpeg"
							alt="Защита объектов 2"
							loading="lazy"
							decoding="async"
						/>
						<img
							src="/photo/image_4.jpeg"
							alt="Защита объектов 1"
							loading="lazy"
							decoding="async"
						/>
					</div>
					<script>
						(function () {
							const slider =
								document.getElementById("dual-images-slider");
							if (!slider) return;
							let scrolling = true;
							setInterval(() => {
								if (!scrolling) return;
								const maxScroll =
									slider.scrollWidth - slider.clientWidth;
								if (slider.scrollLeft >= maxScroll - 2) {
									slider.scrollTo({
										left: 0,
										behavior: "smooth",
									});
								} else {
									slider.scrollBy({
										left: slider.clientWidth,
										behavior: "smooth",
									});
								}
							}, 3000);
							slider.addEventListener("touchstart", () => {
								scrolling = false;
							});
							slider.addEventListener("touchend", () => {
								setTimeout(() => {
									scrolling = true;
								}, 3000);
							});
						})();
					</script>
				</div>

				<div class="bento-features">
					<div class="bento-item hover-card">
						<div
							class="card-bg"
							style="background-image: url('/photo/card_1.jpeg');"
						>
						</div>
						<div class="card-front">
							<p>Автономная работа в режиме 24/7</p>
						</div>
					</div>

					<div class="bento-item hover-card">
						<div
							class="card-bg"
							style="background-image: url('/photo/card_2.png');"
						>
						</div>
						<div class="card-front">
							<p>Защита пограничных объектов и военных частей</p>
						</div>
					</div>

					<div class="bento-item hover-card">
						<div
							class="card-bg"
							style="background-image: url('/photo/card_3.png');"
						>
						</div>
						<div class="card-front">
							<p>
								Защита заводов и промышленных объектов
								Казахстана
							</p>
						</div>
					</div>

					<div class="bento-item hover-card">
						<div
							class="card-bg"
							style="background-image: url('/photo/card_4.jpeg');"
						>
						</div>
						<div class="card-front">
							<p>
								Административных зданий и объектов
								инфраструктуры
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- Contacts Section -->
	<section id="contacts" class="contacts-section">
		<div class="container contacts-container">
			<div class="contact-left">
				<h2>Связаться с нами</h2>
				<p class="contact-desc"></p>

				<ul class="contact-list">
					<li>
						<MapPin
							size={28}
							color="#EA4335"
							className="contact-icon"
						/>
						<span>Астана, Казахстан</span>
					</li>
					<li>
						<span class="contact-icon color-icon">
							<svg
								viewBox="0 0 24 24"
								width="28"
								height="28"
								xmlns="http://www.w3.org/2000/svg"
							>
								<path
									d="M12 2C6.48 2 2 6.48 2 12c0 1.74.45 3.37 1.23 4.8L2 22l5.35-1.12C8.74 21.6 10.32 22 12 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm4.3 14.5c-.24.68-1.38 1.3-1.93 1.37-.52.06-1.17.1-3.37-.78-2.67-1.07-4.38-3.8-4.52-3.98-.13-.19-1.08-1.44-1.08-2.75 0-1.31.68-1.96.93-2.22.24-.26.54-.33.72-.33.19 0 .38 0 .54.01.17 0 .39-.06.6.45.22.54.72 1.77.78 1.91.06.13.11.29.02.48-.09.19-.13.3-.26.45-.13.15-.28.34-.39.45-.13.14-.26.29-.11.55.15.26.68 1.13 1.46 1.83.99.89 1.83 1.17 2.09 1.29.26.13.41.11.56-.06.15-.17.65-.75.82-1.01.17-.26.35-.22.58-.13.24.09 1.5.71 1.76.84.26.13.43.19.5.3.06.11.06.66-.18 1.34z"
									fill="#25D366"></path>
							</svg>
						</span>
						<a href="https://wa.me/77778555556">WhatsApp</a>
					</li>
					<li>
						<span class="contact-icon color-icon">
							<svg
								viewBox="0 0 24 24"
								width="28"
								height="28"
								xmlns="http://www.w3.org/2000/svg"
							>
								<path
									d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"
									fill="#007AFF"></path>
							</svg>
						</span>
						<a href="tel:+77778555556">+7 (777) 855-55-56</a>
					</li>
					<li>
						<span class="contact-icon color-icon">
							<svg
								viewBox="0 0 24 24"
								width="28"
								height="28"
								xmlns="http://www.w3.org/2000/svg"
							>
								<path
									d="M12 11.09l9.38-5.78C21.1 4.54 20.14 4 19 4H5C3.86 4 2.9 4.54 2.62 5.31L12 11.09z"
									fill="#EA4335"></path>
								<path
									d="M21.38 6.44L12 12.23l-9.38-5.79C2.24 6.94 2 7.44 2 8v10c0 1.1.9 2 2 2h15c1.1 0 2-.9 2-2V8c0-.56-.24-1.06-.62-1.56z"
									fill="#FBBC04"></path>
								<path
									d="M2.62 5.31C2.24 5.81 2 6.31 2 6.88L12 13.06l10-6.18c0-.56-.24-1.06-.62-1.56l-9.38 5.78z"
									fill="#34A853"></path>
								<path
									d="M12 13.06V22c5.52 0 10-4.48 10-10 0-1.85-.5-3.58-1.38-5.06L12 13.06z"
									opacity="0.1"></path>
							</svg>
						</span>
						<a href="mailto:info.kaz-bpla@gmail.com"
							>info.kaz-bpla@gmail.com</a
						>
					</li>
				</ul>
			</div>
		</div>
	</section>
</Layout>

<style>
	/* Hero Section */
	.hero {
		position: relative;
		height: 100vh;
		height: 100dvh;
		min-height: 600px;
		display: flex;
		align-items: center;
		justify-content: center;
		overflow: hidden;
		text-align: center;
	}

	.video-background {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		z-index: 1;
		background: #000;
	}

	.hero-video {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		object-fit: cover;
		opacity: 0;
		transition: opacity 1.5s ease-in-out;
	}

	.hero-video.active {
		opacity: 1;
	}

	.overlay {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(18, 18, 18, 0.5); /* Dark overlay */
		z-index: 2;
	}

	.hero-content {
		position: absolute;
		bottom: 110px;
		left: 0;
		right: 0;
		margin: 0 auto;
		z-index: 3;
		max-width: 900px;
		padding: 0 20px;
		animation: fadeIn 1.5s ease-out;
		display: flex;
		flex-direction: column;
		align-items: center;
	}

	.hero-eyebrow {
		font-size: 0.85rem;
		font-weight: 400;
		letter-spacing: 3px;
		text-transform: uppercase;
		color: rgba(255, 255, 255, 0.6);
		margin-bottom: 8px;
	}

	.hero-content h1 {
		font-family: "Russo One", sans-serif;
		font-size: clamp(3rem, 7vw, 6rem);
		font-weight: 400;
		margin-bottom: 20px;
		letter-spacing: 0.5px;
		color: #ffffff;
		line-height: 1.1;
		text-transform: uppercase;
	}

	.hero-desc {
		font-size: 1.1rem;
		font-weight: 700;
		color: rgba(255, 255, 255, 0.9);
		max-width: 700px;
		line-height: 1.6;
		margin-top: 5px;
	}

	/* Audio hint button */
	.audio-hint {
		position: relative;
		z-index: 4;
		display: none;
		flex-direction: column;
		align-items: center;
		gap: 8px;
		background: transparent;
		border: none;
		padding: 10px;
		cursor: pointer;
		color: #ffffff;
		font-family: inherit;
		font-size: 0.85rem;
		letter-spacing: 0.5px;
		transition:
			opacity 0.4s ease,
			transform 0.2s ease;
		opacity: 0;
		margin-bottom: 10px;
	}

	.audio-hint.visible {
		display: flex;
		animation: hintAppear 0.6s ease forwards;
	}

	.audio-hint.hidden {
		opacity: 0 !important;
		pointer-events: none;
		transition: opacity 0.4s ease;
	}

	.audio-hint:hover {
		transform: scale(1.04);
	}

	.audio-hint-icon {
		font-size: 1.8rem;
		animation: tapWiggle 1.2s ease-in-out infinite;
		display: block;
	}

	.audio-hint-text {
		font-size: 0.8rem;
		color: rgba(255, 255, 255, 0.8);
		white-space: nowrap;
	}

	@keyframes hintAppear {
		from {
			opacity: 0;
			transform: translateY(10px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	@keyframes tapWiggle {
		0%,
		100% {
			transform: rotate(0deg) translateY(0);
		}
		20% {
			transform: rotate(-15deg) translateY(-3px);
		}
		40% {
			transform: rotate(10deg) translateY(-1px);
		}
		60% {
			transform: rotate(-8deg) translateY(-2px);
		}
		80% {
			transform: rotate(5deg) translateY(0);
		}
	}

	.scroll-arrow {
		position: absolute;
		bottom: 40px;
		left: 50%;
		transform: translateX(-50%);
		z-index: 3;
		color: rgba(255, 255, 255, 0.7);
		transition: color 0.2s ease;
		display: block;
	}

	.scroll-arrow:hover {
		color: #ffffff;
	}

	/* Sections General */
	section {
		padding: 100px 0;
	}

	.container {
		max-width: 1200px;
		margin: 0 auto;
		padding: 0 20px;
	}

	.container-sm {
		max-width: 900px;
	}

	.text-center {
		text-align: center;
	}

	/* Section Headers */
	.section-header {
		margin-bottom: 60px;
	}

	.section-header.text-center {
		display: flex;
		flex-direction: column;
		align-items: center;
	}

	.section-subtitle {
		display: inline-block;
		font-size: 0.85rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 3px;
		color: var(--text-muted);
		margin-bottom: 15px;
		border: 1px solid var(--border-color);
		padding: 6px 16px;
		border-radius: 30px;
	}

	h2 {
		font-size: 3rem;
		font-weight: 500;
		line-height: 1.1;
		margin: 0;
		letter-spacing: -1px;
	}

	.section-desc {
		font-size: 1.1rem;
		color: var(--text-muted);
		margin-top: 20px;
		max-width: 600px;
		line-height: 1.6;
	}

	/* About Section (Bento Grid) */
	.about-section {
		background: var(--bg-secondary);
		border-bottom: 1px solid var(--border-color);
	}

	.bento-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: 0;
	}

	.bento-features {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		gap: 0;
	}

	.bento-item {
		background: var(--bg-color);
		border: 1px solid var(--border-color);
		padding: 40px;
		display: flex;
		flex-direction: column;
		position: relative;
	}

	.bento-item.hover-card {
		background: transparent;
		min-height: 300px;
	}

	.bento-large {
		padding: 0;
		background: var(--bg-secondary);
		display: flex;
		align-items: stretch;
		min-height: 400px;
	}

	.dual-images {
		display: flex;
		gap: 0;
		width: 100%;
		overflow-x: auto;
		scroll-snap-type: x mandatory;
		-webkit-overflow-scrolling: touch;
		scrollbar-width: none;
	}

	.dual-images::-webkit-scrollbar {
		display: none;
	}

	.dual-images img {
		width: 50%;
		min-width: 50%;
		height: 400px;
		object-fit: cover;
		display: block;
		scroll-snap-align: start;
		flex-shrink: 0;
	}

	.bento-content {
		padding: 50px;
	}

	.bento-content h3 {
		font-size: 2rem;
		font-weight: 500;
		margin-bottom: 20px;
		color: var(--text-color);
		letter-spacing: -0.5px;
	}

	.bento-content p {
		font-size: 1.1rem;
		color: var(--text-muted);
		line-height: 1.7;
		margin: 0;
	}

	.bento-image-wrapper {
		height: 100%;
		min-height: 400px;
	}

	.bento-image-wrapper img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
		filter: grayscale(80%);
		transition: filter 0.4s ease;
	}

	.bento-large .bento-image-wrapper img {
		filter: grayscale(0%);
	}

	.bento-item:hover .bento-image-wrapper img {
		filter: grayscale(0%);
	}

	.hover-card {
		position: relative;
		overflow: hidden;
	}

	.card-bg {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-size: cover;
		background-position: center;
		opacity: 0;
		transition:
			opacity 0.4s ease,
			transform 0.4s ease;
		z-index: 1;
		filter: grayscale(30%) brightness(0.6);
	}

	.hover-card:hover .card-bg {
		opacity: 1;
		transform: scale(1.05);
	}

	.card-front {
		position: relative;
		z-index: 2;
		transition: transform 0.4s ease;
		display: flex;
		flex-direction: column;
		justify-content: flex-end;
		height: 100%;
		flex: 1;
	}

	.hover-card:hover .card-front {
		transform: translateY(-5px);
	}

	.feature-icon-wrapper {
		color: var(--text-color);
		margin-bottom: 25px;
	}

	.bento-item h4 {
		font-size: 1.25rem;
		font-weight: 500;
		margin-bottom: 15px;
		color: var(--text-color);
	}

	.bento-item p {
		color: var(--text-muted);
		line-height: 1.6;
		margin: 0;
		font-size: 0.95rem;
	}

	.bento-item.hover-card::before {
		content: "";
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: var(--bg-color);
		z-index: 0;
		transition: opacity 0.4s ease;
	}

	.bento-item.hover-card:hover::before {
		opacity: 0.5;
	}

	.hover-card:hover .card-front h4,
	.hover-card:hover .card-front p {
		color: #ffffff;
	}

	/* Contacts Section */
	.contacts-section {
		background: #ffffff;
		padding: 120px 0;
	}

	.contacts-container {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 80px;
		align-items: flex-start;
	}

	.contact-left h2 {
		font-size: 2.2rem;
		font-weight: 500;
		letter-spacing: -0.5px;
		margin-bottom: 25px;
		color: #000000;
	}

	.contact-left h2::after {
		display: none;
	}

	.contact-desc {
		color: #555;
		font-size: 0.95rem;
		margin-bottom: 40px;
		line-height: 1.6;
		max-width: 400px;
	}

	.contact-list {
		list-style: none;
		padding: 0;
		margin: 0;
	}

	.contact-list li {
		display: flex;
		align-items: center;
		gap: 20px;
		margin-bottom: 25px;
		color: #121212;
		font-size: 1.25rem;
		font-weight: 500;
	}

	.contact-icon {
		color: #121212;
		flex-shrink: 0;
	}

	.contact-list a {
		color: #121212;
		text-decoration: none;
		transition: all 0.2s ease;
		border-bottom: 1px solid transparent;
	}

	.contact-list a:hover {
		color: #000000;
		border-bottom-color: #000000;
	}

	/* Form */
	.contact-form {
		display: flex;
		flex-direction: column;
		gap: 30px;
	}

	.form-group {
		display: flex;
		flex-direction: column;
	}

	.form-group label {
		font-size: 0.85rem;
		color: #666;
		margin-bottom: 8px;
		font-weight: 500;
	}

	.form-group input,
	.form-group textarea {
		background: transparent;
		border: none;
		border-bottom: 1px solid #ccc;
		padding: 10px 0;
		color: #000;
		font-family: inherit;
		font-size: 1rem;
		outline: none;
		transition: border-color 0.3s ease;
		resize: none;
	}

	.form-group textarea {
		min-height: 40px;
	}

	.form-group input:focus,
	.form-group textarea:focus {
		border-bottom-color: #999;
	}

	.submit-btn {
		background: #000000;
		border: none;
		color: #ffffff;
		font-family: inherit;
		font-size: 0.95rem;
		font-weight: 600;
		cursor: pointer;
		display: flex;
		align-items: center;
		padding: 12px 30px;
		border-radius: 4px;
		margin-top: 20px;
		transition: background-color 0.2s ease;
	}

	.submit-btn:hover {
		background: #333;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
			margin-bottom: -20px;
		}
		to {
			opacity: 1;
			margin-bottom: 0;
		}
	}

	/* Responsive */
	@media (max-width: 992px) {
		.hero-content h1 {
			font-size: clamp(2rem, 10vw, 4rem);
		}

		.bento-large {
			grid-template-columns: 1fr;
		}
		.bento-image-wrapper {
			min-height: 300px;
		}
		h2 {
			font-size: 2.2rem;
		}
		.bento-content {
			padding: 30px;
		}
	}

	@media (max-width: 768px) {
		.hero {
			padding: 60px 0;
		}

		.hero-desc {
			font-size: 1rem;
			padding: 0 15px;
		}

		.bento-features {
			grid-template-columns: 1fr;
		}

		.bento-item {
			padding: 30px 20px;
		}

		.bento-content {
			padding: 40px 20px;
		}

		.bento-content h3 {
			font-size: 1.75rem;
		}

		.contacts-container {
			grid-template-columns: 1fr;
			gap: 50px;
		}

		.dual-images img {
			width: 100%;
			min-width: 100%;
			height: 280px;
		}

		.bento-large {
			min-height: 280px;
			padding: 0;
		}

		/* Show card backgrounds on mobile without hover */
		.card-bg {
			opacity: 1;
		}

		.bento-item.hover-card::before {
			opacity: 0.45;
		}

		.hover-card .card-front h4,
		.hover-card .card-front p {
			color: #ffffff;
		}
	}

	@media (max-width: 480px) {
		.hero-content h1 {
			font-size: 2.2rem;
		}

		.bento-content h3 {
			font-size: 1.5rem;
		}

		.submit-btn {
			width: 100%;
			justify-content: center;
		}
	}
</style>
